package utils_test

import (
	"encoding/hex"
	"testing"

	"github.com/scalarorg/bitcoin-vault/go-utils/btc"
	"github.com/scalarorg/bitcoin-vault/go-utils/chain"
	"github.com/scalarorg/bitcoin-vault/go-utils/types"
	"github.com/scalarorg/relayers/pkg/utils"
	"github.com/stretchr/testify/require"
)

func TestCalculateDestinationAddress(t *testing.T) {
	pubkey, _ := hex.DecodeString("00147c4917362e25568858bb812751107946a3c769b6")
	addr, err := btc.ScriptPubKeyToAddress(pubkey, "testnet4")
	require.NoError(t, err)
	t.Logf("address %s", addr)
	payload, _ := hex.DecodeString("01000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000003EE70736274FF01006B0200000001C0045AFD1A7A7E5216FB912C0B44896CD6702AC1BA42997EC4ED26011AF16D640000000000FDFFFFFF020000000000000000106A0E5343414C41520101417472616E730D2600000000000016001450DCECA158A9C872EB405D52293D351110572C9E000000000001012B10270000000000002251209EC8DC148990200705B97D6EE201362936D7F9CE80926C7A3E1BDB33382AEDA60103040000000041142AE31EA8709AEDA8194BA3E2F7E7E95E680E8B65135C8983C0A298D17BC5350ABFBE5929C41E60294EE315D057BDF5804BEAE58E399B040597FE0073837D370A40E33312F1F16F94E9D57B02AC0AB69161C1ADAE4755C4A12C48624807EB515754D2AF6EFE17083C63B1958A6E8EBB6FDCD1CAC3CEC2B6B8B676C78C3EE174F2FF6215C150929B74C1A04954B78B4B6035E97A5E078A5A0F28EC96D547BFEE9ACE803AC01F1E0BA48405EF2DB77D68D0E6AA10C28609B69487E89AAE8B711045068E496DB835C6DC4A9FA6E96BAF5F5192244DC0D0CB610E6FB838C419FFDDD00EFEAB7AAD202AE31EA8709AEDA8194BA3E2F7E7E95E680E8B65135C8983C0A298D17BC5350AAD2015DA913B3E87B4932B1E1B87D9667C28E7250AA0ED60B3A31095F541E1641488AC20594E78C0A2968210D9C1550D4AD31B03D5E4B9659CF2F67842483BB3C2BB7811BA20B59E575CEF873EA95273AFD55956C84590507200D410E693E4B079A426CC6102BA20F0F3D9BEAF7A3945BCAA147E041AE1D5CA029BDE7E40D8251F0783D6ECBE8FB5BA53A2C0211615DA913B3E87B4932B1E1B87D9667C28E7250AA0ED60B3A31095F541E16414882501BFBE5929C41E60294EE315D057BDF5804BEAE58E399B040597FE0073837D370A0000000021162AE31EA8709AEDA8194BA3E2F7E7E95E680E8B65135C8983C0A298D17BC5350A2501BFBE5929C41E60294EE315D057BDF5804BEAE58E399B040597FE0073837D370A000000002116594E78C0A2968210D9C1550D4AD31B03D5E4B9659CF2F67842483BB3C2BB78112501BFBE5929C41E60294EE315D057BDF5804BEAE58E399B040597FE0073837D370A000000002116B59E575CEF873EA95273AFD55956C84590507200D410E693E4B079A426CC61022501BFBE5929C41E60294EE315D057BDF5804BEAE58E399B040597FE0073837D370A000000002116F0F3D9BEAF7A3945BCAA147E041AE1D5CA029BDE7E40D8251F0783D6ECBE8FB52501BFBE5929C41E60294EE315D057BDF5804BEAE58E399B040597FE0073837D370A0000000001172050929B74C1A04954B78B4B6035E97A5E078A5A0F28EC96D547BFEE9ACE803AC00118204E6C5ABA100167B13A7A291B09AD74ECE13A54AD3F920E0438F6156C47E4A860000000000000000000000000000000000000000000")
	//payload, _ = hex.DecodeString("00000000000000000000000000000000000000000000000000000000000000128500000000000000000000000000000000000000000000000000000000000000C000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000440000000000000000000000000000000000000000000000000000000000000050030C7284B1653F17CF67E6B6D0A787A34AC51151A7611F4F9F3663CAD8638914400000000000000000000000000000000000000000000000000000000000000147C4917362E25568858BB812751107946A3C769B6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001A0000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002A000000000000000000000000000000000000000000000000000000000000000423078373337376362613333366366663665306433393437383732323436633939666438303935303533663138646162323961613763366330363233643137633035320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000042307833323465346437323638623062363562613666643731333539623634363061383261396661653137616637343334623438616436333265323033313536623735000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004230783764326233326537666438326436633831393662303161323166616266353765353431666637636234623966353062323738353964386337363639623566616100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000423078653439393237666532313066626237333961626266333539343538356534376361346362623830323165656363363732616535303961336434366562396639340000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000042307831326530626662393962306138643530626138313461383464623234653935333530393331316331343139636166646464383631326566633839393462346336000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000003E800000000000000000000000000000000000000000000000000000000000003E80000000000000000000000000000000000000000000000000000000000000458000000000000000000000000000000000000000000000000000000000000053300000000000000000000000000000000000000000000000000000000000003E8")
	b := chain.ChainInfo{
		ChainType: types.ChainTypeBitcoin,
		ChainID:   1,
	}

	destinationAddress, err := utils.CalculateDestinationAddress(payload, (*chain.ChainInfoBytes)(b.Bytes()))
	if err != nil {
		t.Fatalf("failed to calculate destination address: %v", err)
	}

	t.Logf("destination address: %v", destinationAddress)
}
