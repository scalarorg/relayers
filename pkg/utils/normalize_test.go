package utils_test

import (
	"encoding/hex"
	"testing"

	"github.com/scalarorg/bitcoin-vault/go-utils/chain"
	"github.com/scalarorg/bitcoin-vault/go-utils/types"
	"github.com/scalarorg/relayers/pkg/utils"
)

func TestCalculateDestinationAddress(t *testing.T) {
	payload, _ := hex.DecodeString("01000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000003EE70736274FF01006B0200000001C0045AFD1A7A7E5216FB912C0B44896CD6702AC1BA42997EC4ED26011AF16D640000000000FDFFFFFF020000000000000000106A0E5343414C41520101417472616E730D2600000000000016001450DCECA158A9C872EB405D52293D351110572C9E000000000001012B10270000000000002251209EC8DC148990200705B97D6EE201362936D7F9CE80926C7A3E1BDB33382AEDA60103040000000041142AE31EA8709AEDA8194BA3E2F7E7E95E680E8B65135C8983C0A298D17BC5350ABFBE5929C41E60294EE315D057BDF5804BEAE58E399B040597FE0073837D370A40E33312F1F16F94E9D57B02AC0AB69161C1ADAE4755C4A12C48624807EB515754D2AF6EFE17083C63B1958A6E8EBB6FDCD1CAC3CEC2B6B8B676C78C3EE174F2FF6215C150929B74C1A04954B78B4B6035E97A5E078A5A0F28EC96D547BFEE9ACE803AC01F1E0BA48405EF2DB77D68D0E6AA10C28609B69487E89AAE8B711045068E496DB835C6DC4A9FA6E96BAF5F5192244DC0D0CB610E6FB838C419FFDDD00EFEAB7AAD202AE31EA8709AEDA8194BA3E2F7E7E95E680E8B65135C8983C0A298D17BC5350AAD2015DA913B3E87B4932B1E1B87D9667C28E7250AA0ED60B3A31095F541E1641488AC20594E78C0A2968210D9C1550D4AD31B03D5E4B9659CF2F67842483BB3C2BB7811BA20B59E575CEF873EA95273AFD55956C84590507200D410E693E4B079A426CC6102BA20F0F3D9BEAF7A3945BCAA147E041AE1D5CA029BDE7E40D8251F0783D6ECBE8FB5BA53A2C0211615DA913B3E87B4932B1E1B87D9667C28E7250AA0ED60B3A31095F541E16414882501BFBE5929C41E60294EE315D057BDF5804BEAE58E399B040597FE0073837D370A0000000021162AE31EA8709AEDA8194BA3E2F7E7E95E680E8B65135C8983C0A298D17BC5350A2501BFBE5929C41E60294EE315D057BDF5804BEAE58E399B040597FE0073837D370A000000002116594E78C0A2968210D9C1550D4AD31B03D5E4B9659CF2F67842483BB3C2BB78112501BFBE5929C41E60294EE315D057BDF5804BEAE58E399B040597FE0073837D370A000000002116B59E575CEF873EA95273AFD55956C84590507200D410E693E4B079A426CC61022501BFBE5929C41E60294EE315D057BDF5804BEAE58E399B040597FE0073837D370A000000002116F0F3D9BEAF7A3945BCAA147E041AE1D5CA029BDE7E40D8251F0783D6ECBE8FB52501BFBE5929C41E60294EE315D057BDF5804BEAE58E399B040597FE0073837D370A0000000001172050929B74C1A04954B78B4B6035E97A5E078A5A0F28EC96D547BFEE9ACE803AC00118204E6C5ABA100167B13A7A291B09AD74ECE13A54AD3F920E0438F6156C47E4A860000000000000000000000000000000000000000000")

	b := chain.ChainInfo{
		ChainType: types.ChainTypeBitcoin,
		ChainID:   1,
	}

	destinationAddress, err := utils.CalculateDestinationAddress(payload, (*chain.ChainInfoBytes)(b.Bytes()))
	if err != nil {
		t.Fatalf("failed to calculate destination address: %v", err)
	}

	t.Logf("destination address: %v", destinationAddress)
}
